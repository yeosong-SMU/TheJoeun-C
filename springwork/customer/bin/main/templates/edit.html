<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>고객 수정</title>
<script>
	function confirmDelete(id) {
		if(confirm('정말 삭제하시겠습니까?')) {
			location.href='/delete?id=' + id;
		}
	}
	
	function handleClick(el) {
		const id = el.dataset.id;
		const content = el.dataset.content;
		const date = el.dataset.date;
		openModal(id, content, date);
	}
	
	function openModal(id, content, date) {
		document.getElementById('modalId').value = id;
		document.getElementById('modalContent').value = content;
		document.getElementById('modalDate').value = date;
		document.getElementById('modal').style.display = 'block';
	}
	
	function closeModal() {
		document.getElementById('modal').style.display = 'none';
	}
	
	function deleteConsultation() {
		const id = document.getElementById('modalId').value;
		if(confirm('정말 상담을 삭제하시겠습니까?')) {
			location.href='/consultation/delete/' + id;
		}
	}
</script>
<style>
textarea {
	width: 100%;
	box-sizing: border-box;
	resize: vertical;
	word-wrap: break-word;
}
</style>
</head>
<body>
<h1>고객 정보 수정</h1>

<form action="/update" method="post">
	<input type="hidden" name="id" th:value="${customer.id}">
	<div>
		이름: <input type="text" th:value="${customer.name}" required>
	</div>
	<div>
		전화번호: <input type="text" name="phone" th:value="${customer.phone}">
	</div>
	<div>
		이메일: <input type="email" name="email" th:value="${customer.email}">
	</div>
	<br>
	<button type="submit">수정</button>
	<button type="button" th:onclick="|confirmDelete([[${customer.id}]])|">삭제</button>
	<button type="button" onclick="location.href='/'">목록</button>
</form>

<hr>

<h2>상담 내역</h2>
<table border="1">
	<thead>
		<tr>
			<th>상담 내용</th>
			<th>상담일</th>
		</tr>
	</thead>
	<tbody>
		<tr th:if="${#lists.isEmpty(consultations)}">
			<td colspan="2">상담 내역이 없습니다.</td>
		</tr>
		<tr th:each="c : ${consultations}">
			<td><a href="#" th:attr="data-id=${c.id}, data-content=${c.content}, data-date=${c.consultationDate}" onclick="handleClick(this)" th:text="${c.content}">상담 내용</a></td>
			<td th:text="${c.consultationDate}">날짜</td>
		</tr>
	</tbody>
</table>

<br>
<h3>상담 추가</h3>
<form action="/consultation/add" method="post">
	<input type="hidden" name="customerId" th:value="${customer.id}">
	<textarea name="content" rows="3" cols="50" required></textarea>
	<br>
	<button type="submit">상담 저장</button>
</form>

<div id="modal" style="display: none; position: fixed; left: 30%; top: 20%; width: 40%; background: #fff; border: 1px solid #ccc; padding: 20px; box-shadow: 0 0 10px #000;">
	<h3>상담 수정</h3>
	<form id="modalForm" method="post" action="/consultation/update">
		<input type="hidden" name="id" id="modalId">
		<input type="hidden" name="customerId" th:value="${customer.id}">
		내용<br>
		<textarea name="content" id="modalContent" rows="4" cols="50"></textarea>
		<br><br>
		상담일<br> <input type="date" name="consultationDate" id="modalDate">
		<br><br>
		<button type="submit">수정</button>
		<button type="button" onclick="deleteConsultation()">삭제</button>
		<button type="button" onclick="closeModal()">닫기</button>
	</form>
</div>
</body>
</html>