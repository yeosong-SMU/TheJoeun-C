<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>도서 수정</title>
<link rel="stylesheet" th:href="@{/css/main.css}">
<script>
function confirmDelete() {
	if(confirm('정말 삭제하시겠습니까?')) {
		document.form1.action = '/books/delete';
		document.form1.submit();
	}
}
function openReviewModal(element) {
	const id = element.getAttribute('data-id');
	const reviewer = element.getAttribute('data-reviewer');
	const content = element.getAttribute('data-content');
	const rating = element.getAttribute('data-rating');
	
	document.getElementById('reviewId').value = id;
	document.getElementById('reviewReviewer').value = reviewer;
	document.getElementById('reviewContent').value = content;
	document.getElementById('reviewRating').value = rating;
	document.getElementById('reviewModal').style.display = 'block';
}

function closeReviewModal() {
	document.getElementById('reviewModal').style.display = 'none';
}
</script>
</head>
<body>
<div th:replace="include/nav :: menu"></div>
<h2>도서 수정</h2>
<form name="form1" th:action="@{/books/edit}" th:object="${book}" method="post">
	<input type="hidden" th:field="*{id}" />
	<label>제목 : </label><input type="text" th:field="*{title}" required /><br>
	<label>저자 : </label><input type="text" th:field="*{author}" required /><br>
	<label>출판사 : </label><input type="text" th:field="*{publisher}" required /><br>
	<label>출판일 : </label><input type="date" th:field="*{publishedDate}" required /><br>
	<button type="submit">수정</button>
	
	<input type="hidden" name="id" th:value="${book.id}" />
	<button type="button" onclick="confirmDelete()">삭제</button>
	<button type="button" onclick="location.href='/books'">목록으로</button>
</form>

<hr>

<h3>리뷰 작성</h3>
<form th:action="@{/reviews/add}" method="post">
	<input type="hidden" name="book.id" th:value="${book.id}" />
	<input type="text" name="reviewer" placeholder="작성자" required /><br>
	<textarea name="content" placeholder="내용" required></textarea><br>
	<input type="number" name="rating" min="1" max="5" placeholder="평점" />
	<button type="submit">리뷰 등록</button>
</form>

<h3>리뷰 목록</h3>

<div th:if="${#lists.isEmpty(reviews)}">
	<p>리뷰가 없습니다.</p>
</div>

<table border="1" cellpadding="5" th:if="${not #lists.isEmpty(reviews)}">
	<tr>
		<th>작성자</th>
		<th>내용</th>
		<th>평점</th>
		<th>작성일</th>
	</tr>
	<tr th:each="r : ${reviews}">
		<td th:text="${r.reviewer}"></td>
		<td><a href="#" th:attr="data-id=${r.id}, 
			data-reviewer=${r.reviewer}, 
			data-content=${r.content}, 
			data-rating=${r.rating}" 
			onclick="openReviewModal(this)" 
			th:text="${r.content}"></a></td>
		<td th:text="${r.rating}"></td>
		<td th:text="${#dates.format(r.reviewDate, 'yyyy-MM-dd')}"></td>
	</tr>
</table>
<div id="reviewModal" 
	style="display:none; position:fixed; 
	top:20%; left:30%; background:white; 
	padding:20px; border:1px solid #ccc;">
	<form id="reviewForm" method="post">
		<input type="hidden" name="id" id="reviewId">
		<input type="hidden" name="book.id" th:value="${book.id}" />
		<label>작성ㅈ: </label><br>
		<input type="text" name="reviewer" id="reviewReviewer"><br>
		
	</form>
</div>
</body>
</html>