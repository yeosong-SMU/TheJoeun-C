<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>당뇨병 데이터 수정</title>
</head>
<body>
<h2>당뇨병 데이터 수정</h2>

<form th:action="@{'/diabetes/edit/' + ${diabetes.id}}" method="post" th:object="${diabetes}">
	<input type="hidden" th:field="*{id}">
	
	<table>
		<tr>
			<td>Pregnancies</td>
			<td><input type="number" th:field="*{pregnancies}" id="pregnancies" required></td>
		</tr>
		<tr>
			<td>Glucose</td>
			<td><input type="number" th:field="*{glucose}" id="glucose" required></td>
		</tr>
		<tr>
			<td>Blood Pressure</td>
			<td><input type="number" th:field="*{bloodPressure}" id="bloodPressure" required></td>
		</tr>
		<tr>
			<td>Skin Thickness</td>
			<td><input type="number" th:field="*{skinThickness}" id="skinThickness" required></td>
		</tr>
		<tr>
			<td>Insulin</td>
			<td><input type="number" th:field="*{insulin}" id="insulin" required></td>
		</tr>
		<tr>
			<td>BMI</td>
			<td><input type="number" step="0.1" th:field="*{bmi}" id="bmi" required></td>
		</tr>
		<tr>
			<td>Diabetes Pedigree</td>
			<td><input type="number" step="0.001" th:field="*{diabetesPedigree}" id="diabetesPedigree" required></td>
		</tr>
		<tr>
			<td>Age</td>
			<td><input type="number" th:field="*{age}" id="age" required></td>
		</tr>
		<tr>
			<td>Prediction</td>
			<td>
				<select th:field="*{prediction}" id="prediction">
					<option value="0">정상</option>
					<option value="1">당뇨병</option>
				</select>
			</td>
		</tr>
		<tr>
			<td>Probability</td>
			<td><input type="number" step="0.0001" th:field="*{probability}" id="probability" readonly></td>
		</tr>
	</table>
	
	<button type="submit">저장</button>
	<button type="button" onclick="location.href='/diabetes'">목록</button>
</form>

<script>
const fields = [
	"pregnancies", "glucose", "bloodPressure", "skinThickness", 
    "insulin", "bmi", "diabetesPedigree", "age"
];

fields.forEach(field => {
	document.getElementById(field).addEventListener("input", updatePrediction);
});

function updatePrediction() {
	const data = {};
	fields.forEach(field => {
		const value = parseFloat(document.getElementById(field).value);
		data[field] = isNaN(value) ? 0 : value;
	});
	
	fetch("http://localhost:8000/predict", {
		method: "POST",
		headers: {"Content-Type": "application/json"},
		body: JSON.stringify(data)
	})
	.then(response => response.json())
	.then(result => {
		if("probability" in result) {
			document.getElementById("probability").value=result.probability.toFixed(4);
			document.getElementById("prediction").value = result.prediction;
		}
	})
	.catch(error => console.error("Flask API 호출 오류: ", error));
}
</script>
</body>
</html>