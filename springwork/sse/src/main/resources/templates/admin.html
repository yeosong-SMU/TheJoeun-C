<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>관리자 대시보드</title>
</head>
<body>
<h2>실시간 알림</h2>
<div id="log"></div>

<script>
const log = document.getElementById('log');
//실시간 알림 서비스 구독 요청
const es = new EventSource('/admin/notifications/stream');

es.addEventListener('init', (e) => {
	const arr = JSON.parse(e.data);
	arr.forEach(addItem);
});

es.addEventListener('notify', (e) => {
	const n = JSON.parse(e.data);
	addItem(n, true);
});

es.onerror = () => {
	console.warn('SSE 오류(자동 재시도)');
};

function addItem(n, highlight=false) {
	const div = document.createElement('div');
	div.className = `item ${n.level || 'INFO'}`;
	div.innerHTML = `
		<div><b>${n.title}</b></div>
		<div>${n.message}</div>
		<div style="font-size:12px; color:#777">상품ID: ${n.productId} / 상태: ${n.status}</div>
	`;
	if (highlight) div.style.background = '#fff7ed';
	log.prepend(div);
}
</script>
</body>
</html>