<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Churn 추가</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h1>Churn 추가</h1>
<form action="/churn/add" method="post" th:object="${churn}">
	<label for="customerId">고객 ID</label>
	<input type="text" id="customerId" name="customerId" th:field="*{customerId}" required onchange="checkAndPredict()"><br><br>
	
	<label for="age">나이</label>
	<input type="number" id="age" name="age" th:field="*{age}" required onchange="checkAndPredict()"><br><br>
	
	<label for="gender">성별</label>
	<select id="gender" name="gender" th:field="*{gender}" required onchange="checkAndPredict()">
		<option value="남성">남성</option>
		<option value="여성">여성</option>
	</select><br><br>
	
	<label for="tenureMonths">계약 기간 (개월)</label>
	<input type="number" id="tenureMonths" name="tenureMonths" th:field="*{tenureMonths}" required onchange="checkAndPredict()"><br><br>
	
	<label for="monthlyCharges">월 요금</label>
	<input type="number" step="0.01" id="monthlyCharges" name="monthlyCharges" th:field="*{monthlyCharges}" required onchange="checkAndPredict()"><br><br>
	
	<label for="contractType">계약 유형</label>
	<select id="contractType" name="contractType" th:field="*{contractType}" required onchange="checkAndPredict()">
		<option value="월별 계약">월별 계약</option>
		<option value="1년 계약">1년 계약</option>
		<option value="2년 계약">2년 계약</option>
	</select><br><br>
	
	<label for="paymentMethod">결제 방식</label>
	<select id="paymentMethod" name="paymentMethod" th:field="*{paymentMethod}" required onchange="checkAndPredict()">
		<option value="카드">카드</option>
		<option value="계좌 이체">계좌 이체</option>
	</select><br><br>
	
	<label for="internetService">인터넷 서비스</label>
	<select id="internetService" name="internetService" th:field="*{internetService}" required onchange="checkAndPredict()">
		<option value="100M">100M</option>
		<option value="500M">500M</option>
		<option value="1G">1G</option>
		<option value="없음">없음</option>
	</select><br><br>
	
	<label for="churn">이탈여부</label>
	<input type="text" id="churn" name="churn" th:field="*{churn}" required onchange="checkAndPredict()"><br><br>
	
	<label for="churnProbability">이탈 확률</label>
	<input type="text" id="churnProbability" name="churnProbability" th:field="*{churnProbability}" required onchange="checkAndPredict()"><br><br>
	
	<button type="submit">Churn 추가</button>
</form>
<a href="/churn">목록으로 돌아가기</a>

<script>
function checkAndPredict() {
	const formData = {
			age: document.getElementById('age').value,
			gender: document.getElementById('gender').value,
			tenure_months: document.getElementByID('tenureMonths').value,
			monthly_charges: document.getElementByID('monthlyCharges').value,
			contract_type: document.getElementByID('contractType').value,
			payment_method: document.getElementByID('paymentMethod').value,
			internet_service: document.getElementByID('internetService').value,
	};
	
	if(Object.values(formData).includes("")) {
		return;
	}
	
	getChurnPrediction(formData);
}

function getChurnPrediction(formData) {
	$.ajax({
		url: 'http://localhost:5000/predict',
		type: 'POST',
		contentType: 'application/json',
		data: JSON.stringify(formData),
		success: function(response) {
			document.getElementById('churn').value = response.predicted_churn;
			document.getElementById('churnProbability').value = response.churn_probability;
		}
	});
}
</script>
</body>
</html>